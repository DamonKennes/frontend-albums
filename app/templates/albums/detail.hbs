{{page-title @model.title}}

<div class="album-detail">
  <LinkTo @route="albums.index" class="back-link">‚Üê Back to Albums</LinkTo>

  <div class="album-detail-header">
    <div class="album-detail-image">
      {{#if @model.cover}}
        <img src={{@model.cover}} alt={{@model.title}} />
      {{else}}
        <div class="album-detail-placeholder">No Image</div>
      {{/if}}
    </div>

    <div class="album-detail-info">
      <h1>{{@model.title}}</h1>

      {{#each @model.artists as |artist|}}
        <h2 class="album-artist">{{artist.name}}</h2>
      {{/each}}

      {{#if @model.releasedate}}
        <p><strong>Release Date:</strong> {{@model.releasedate}}</p>
      {{/if}}

      {{#if @model.genre}}
        <p><strong>Genre:</strong> {{@model.genre}}</p>
      {{/if}}

      <p><strong>Average rating:</strong> {{@model.averagerating}}</p>

      {{#if this.session.isAuthenticated}}
        <button type="button" {{on "click" this.showDeleteConfirmation}} class="button">
          Delete Album
        </button>
      {{/if}}

    </div>
  </div>

  <ModalConfirm
    @isOpen={{this.showDeleteModal}}
    @title="Delete Album"
    @message="Are you sure you want to delete this album? This action cannot be undone and will also delete all ratings for this album."
    @confirmText="Delete"
    @onConfirm={{this.confirmDelete}}
    @onCancel={{this.cancelDelete}}
  />

  <div class="album-ratings">
    <h3>Ratings & Reviews</h3>

    {{#if @model.ratings}}
      <ul class="ratings-list">
        {{#each @model.ratings as |rating|}}
          <li class="rating-item">
            <div class="rating-score">
              <StarRating @value={{rating.score}} @readOnly={{true}} />
            </div>
            <div class="rating-text">{{rating.text}}</div>
            {{#if rating.creationdate}}
              <div class="rating-date">{{rating.useraccount.accountname}}</div>
              <div class="rating-date">{{rating.creationdate}}</div>
            {{/if}}
            {{#if (this.checkRating rating)}}
              <button class="button" {{on "click" (fn this.deleteRating rating)}}>Delete</button>
            {{/if}}

          </li>
        {{/each}}
      </ul>
    {{else}}
      <p>{{if this.session.isAuthenticated "No ratings yet. Be the first to review this album!" "Login to read user reviews!"}}</p>
    {{/if}}


    {{#if this.session.isAuthenticated}}
      {{#unless this.hasUserRating}}
        <div class="add-rating-form">
          <h4>Add Your Review</h4>
          <form {{on "submit" this.addRating}}>
            <div class="form-field">
              <label for="rating-text">Review:</label>
              <Input
                @type="text"
                @value={{this.newRatingText}}
                id="rating-text"
                placeholder="Write your review..."
              />
            </div>

            <div class="form-field">
              <label for="rating-score">Score:</label>
              <StarRating @value={{this.newRatingScore}} @onChange={{this.updateRatingScore}} />
            </div>

            <button type="submit" class="button">Add Review</button>
          </form>
        </div>
      {{/unless}}
    {{/if}}

  </div>
</div>
